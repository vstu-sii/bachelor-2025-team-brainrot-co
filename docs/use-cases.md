# Use-case Narrative — "Моя неделя в highlights"

**Краткое описание:**
Пользователь подключает личный Telegram-канал — система анализирует сообщения и медиа за последнюю неделю (текст, фото, геолокации, эмоциональная окраска) и автоматически генерирует короткий видеоролик (Instagram Reels / TikTok) с саундтреком и эффектами: "Моя неделя в highlights". Итоговый файл доступен для предпросмотра, редактирования и экспорта.

---

## Scope
- Система обрабатывает содержимое только из аккаунта/канала, на который пользователь даёт разрешение.
- Анализ ограничен промежутком в 7 дней (последняя неделя).
- Поддерживаемые форматы медиа: JPG, PNG.

---

## Preconditions
- Пользователь имеет Telegram-аккаунт и права на выбранный канал/чат.
- Пользователь авторизовал доступ
- На стороне сервера доступны AI-модели для анализа текста и медиа.

## Postconditions
- Сгенерирован видеоклип в формате Reels
- Пользователь может скачать или поделиться роликом.
- Логи и метрики генерации сохранены для дебага и аналитики согласно политике хранения.

---

# Happy Path

**Цель:** пользователь получает корректно сгенерированный ролик "Моя неделя в highlights"

**Шаги**
1. Пользователь заходит в веб-приложение и выбирает "Создать reel: Моя неделя".
2. UI предлагает подключиться к Telegram — показывается объяснение, какие данные будут прочитаны (текст, фото, геолокации, метаданные). Пользователь подтверждает.
3. Происходит OAuth / авторизация бота: система получает токен/доступ и подтверждает успешное подключение.
4. Пользователь нажимает "Анализировать".
5. Бэкенд запускает pipeline:
   - Получение сообщений/медиа через Telegram API.
   - Фильтрация дубликатов и неподдерживаемых форматов.
   - Анализ текста (ключевые события, тональность/настроение).
   - Классификация фото. 
   - Подбор трека: автоматическое сопоставление эмоциональной окраски недели с подходящим музыкальным фоном.
   - Генерация видеомонтажа: монтаж сцен, переходы, титры.
6. После завершения обработки пользователь получает уведомление в приложении.
7. Пользователь получает видео и может открыть предпросмотр.
8. Если пользователь доволен — нажимает "Экспорт" и получает MP4-файл в формате Reels (9:16) и TikTok.
9. Система отображает метрики: количество проанализированных постов, средняя эмоция, использованный трек, время генерации.
10. Конец сценария: файл скачан и статус задачи помечен как "Успешно".

**User Value**
- Экономия времени: автоматическая генерация ролика вместо ручного монтажа.
- Повышение качества контента: AI подбирает лучшие кадры и музыку, улучшая вовлечённость.
- Психологическая ценность: визуализация недели, сохранение воспоминаний.

---

# Alternative Flows

## Alternative A: Нет интернета
**Когда:** у пользователя отключился интернет.
**Шаги:**
- На шаге 4 пользователь переключает опцию "Только текст".
- Анализ фокусируется на извлечении ключевых событий и эмоций из текста.
- Система генерирует видео с текстовыми слайдами и подходящим бэкграундом (без фото/видео).
**User Value:** быстрый результат при отсутствии медиа; снижает время обработки и потребление ресурсов.


## Alternative B: Пользователь отменил процесс на середине

**Когда:** пользователь передумал и хочет остановить генерацию.
**Шаги:**
- На шаге 5–6 пользователь нажимает кнопку «Отмена».
- Бэкенд останавливает pipeline, очищает временные файлы.
- UI предлагает сохранить черновик (например, собранный список медиа/событий).
**User Value:** пользователь сохраняет контроль, не тратит ресурсы и время на ненужный результат.

---

# Error Handling

## Error 1: Технический сбой
**Проявление:** невозможно получить сообщения или анализ останавливается с ошибкой.
**Как обрабатывать:**
- Повтор до N попыток.
- Фоллбек: частичная обработка доступных данных и информирование пользователя о полной/частичной генерации.
- Логи + алерты ошибки.
**UX:** показать пользователю понятное сообщение: "Мы столкнулись с технической ошибкой при подключении к Telegram/AI"


## Error 2: Некорректный ввод / недостаточные права
**Проявление:** авторизация не пройдена или нет доступа к каналу.
**Как обрабатывать:**
- Валидировать токен при получении и отображать точную причину (настройки приватности, требуется роль администратора).
- Предложить режим "ограниченного анализа" (только публичные сообщения, если доступ разрешён частично).
**UX:** уведомление: "Недостаточно прав для чтения сообщений. Проверьте настройки и повторите авторизацию."
**User Value:** снижает фрикции при подключении, экономит время на поддержку.

## Error 3: Ошибка рендеринга видео
**Проявление:** финальный экспорт обрывается из-за нехватки ресурсов на сервере.
**Как обрабатывать:**
- Автоматическая повторная сборка в фоновом режиме.
- Логирование и отправка ошибки в мониторинг.
**UX:** уведомление: "При рендеринге возникла ошибка"
**User Value:** Пользовател узнает об ошибке




