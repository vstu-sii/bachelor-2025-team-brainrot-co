# Use-case Narrative — "Моя неделя в highlights"

**Краткое описание:**
Пользователь подключает личный Telegram-канал — система анализирует сообщения и медиа за последнюю неделю (текст, фото, геолокации, эмоциональная окраска) и автоматически генерирует короткий видеоролик (Instagram Reels / TikTok) с саундтреком и эффектами: "Моя неделя в highlights". Итоговый файл доступен для предпросмотра, редактирования и экспорта.

---

## Scope
- Система обрабатывает содержимое только из аккаунта/канала, на который пользователь даёт разрешение.
- Анализ ограничен промежутком в 7 дней (последняя неделя).
- Поддерживаемые форматы медиа: JPG, PNG.

---

## Preconditions
- Пользователь имеет Telegram-аккаунт и права на выбранный канал/чат.
- Пользователь авторизовал доступ
- На стороне сервера доступны AI-модели для анализа текста и медиа.

## Postconditions
- Сгенерирован видеоклип в формате Reels
- Пользователь может скачать или поделиться роликом.
- Логи и метрики генерации сохранены для дебага и аналитики согласно политике хранения.

---

# Happy Path

**Цель:** пользователь получает корректно сгенерированный ролик "Моя неделя в highlights"

**Шаги**
1. Пользователь заходит в веб-приложение и регистрируется.
2. Выбирает "Создать reels: Моя неделя"
3. UI предлагает указать ссылку на телеграм канал.
4. Бот валидирует ссылку и подключается к каналу.
5. Пользователь пишет промпт для видео и выбирает музыку из заранее созданного списка
6. Пользователь нажимает "Анализировать".
7. Бэкенд запускает pipeline:
   - Получение сообщений/медиа через Telegram API за период 7 дней.
   - Фильтрация дубликатов и неподдерживаемых форматов.
   - Анализ текста (ключевые события, тональность/настроение).
   - Классификация фото. 
   - Подбор трека, если музыка не выбрана заранее: автоматическое сопоставление эмоциональной окраски недели с подходящим музыкальным фоном.
   - Генерация видеомонтажа: монтаж сцен, переходы, титры.
8. После завершения обработки пользователь получает уведомление в приложении.
9. Пользователь получает видео и может открыть предпросмотр.
10. Если пользователь доволен — нажимает "Экспорт" и получает MP4-файл в формате Reels (9:16) и TikTok.
11. Система отображает метрики: количество проанализированных постов, средняя эмоция, использованный трек, время генерации.
12. Конец сценария: файл скачан и статус задачи помечен как "Успешно".


**User Value**
- Экономия времени: автоматическая генерация ролика вместо ручного монтажа.
- Повышение качества контента: AI подбирает лучшие кадры и музыку, улучшая вовлечённость.
- Психологическая ценность: визуализация недели, сохранение воспоминаний.

---
# Use Cases — проект «Моя неделя в highlights»

## UC-1. Регистрация пользователя
**Описание**  
Пользователь создаёт учётную запись в веб-приложении, чтобы получить доступ к функционалу (подключение канала, генерация роликов и т.п.).

**Акторы**  
- Незарегистрированный пользователь  
- Система (аутентификация, БД)  
- Почтовый сервис  

**Начальное состояние**  
Пользователь на странице регистрации; учётной записи нет.

**Триггер**  
Пользователь нажимает «Регистрация».

**Успешный сценарий**
1. Пользователь открывает форму регистрации и вводит логин, пароль.
2. Система валидирует поля.
3. Система создаёт учётную запись в базе.
4. Система переводит аккаунт в статус «активен».

**Негативный сценарий**
- Некорректные данные → сообщение об ошибке.
- Ошибка сети → регистрация не завершена.

**Конечное состояние**  
При успехе — аккаунт активен. При ошибке — учётной записи нет.

---

## UC-2. Добавление Telegram-канала
**Описание**  
Пользователь подключает свой Telegram-канал для анализа сообщений и генерации ролика.

**Акторы**  
- Пользователь  
- Система  
- Telegram API/Bot  

**Начальное состояние**  
Пользователь залогинен; каналов нет.

**Триггер**  
Пользователь выбирает «Добавить канал».

**Успешный сценарий**
1. UI предлагает ввести ссылку или инициировать подключение через бота.
2. Пользователь вводит ссылку или запускает диалог с ботом.
3. Система проверяет ссылку и права доступа.
4. Пользователь даёт разрешение боту.
5. Система сохраняет метаданные канала.
6. UI показывает статус «Канал подключён».

**Альтернативный сценарий**
- Канал приватный → требуется приглашение.
- Ошибочная ссылка → подсказка.

**Негативный сценарий**
- Ошибка подключения к Telegram API.  
- Канал уже подключён.  


**Критерии приёмки**  
- Подключение публичных/приватных каналов.  
- Инструкции по авторизации бота.  

---

## UC-3. Ввод промпта
**Описание**  
Пользователь задаёт текстовый промпт для генерации ролика.

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Канал подключён; пользователь создаёт Reels.

**Триггер**  
Пользователь нажимает «Добавить промпт».

**Успешный сценарий**
1. UI показывает поле ввода промпта.  
2. Пользователь вводит текст.  
3. Система парсит промпт и показывает краткую интерпретацию.  
4. Пользователь подтверждает.  

**Альтернативный сценарий**
- Выбор шаблона.  
- Автогенерация промпта системой.  

**Конечное состояние**  
Промпт сохранён.

**Критерии приёмки**  
- Поле для ввода промпта.  
- Шаблоны и автогенерация.  

---

## UC-4. Выбор диапазона анализа
**Описание**  
Пользователь выбирает временной диапазон сообщений (по умолчанию 7 дней).

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Канал подключён.

**Триггер**  
Пользователь выбирает «Изменить период».

**Успешный сценарий**
1. UI показывает календарь/предустановки.  
2. Пользователь выбирает даты.  
3. Система рассчитывает объём данных.  
4. Пользователь подтверждает.  

**Альтернативный сценарий**
- Пользователь выбирает слишком старые даты → предупреждение.  

**Негативный сценарий**
- В выбранном диапазоне нет данных.  

**Конечное состояние**  
Диапазон задан.

**Критерии приёмки**  
- Подсчёт объёма данных.  
- Проверка доступности истории.  

---

## UC-5. Предпросмотр видео и данных
**Описание**  
Пользователь просматривает сгенерированный ролик и метаданные.

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Генерация завершена.

**Триггер**  
Пользователь нажимает «Предпросмотр».

**Успешный сценарий**
1. UI открывает плеер 9:16 и панель метрик.  
2. Отображаются: число сообщений, эмоция, трек, кадры.  
3. Пользователь воспроизводит, переходит по таймлинии.  
4. Пользователь может перейти к корректировке или экспорту.  

**Альтернативный сценарий**
- Черновик в низком качестве.  

**Негативный сценарий**
- Ошибка загрузки превью.  

**Конечное состояние**  
Видео просмотрено.  

**Критерии приёмки**  
- Плеер и метрики доступны.  
- Возможность перехода к исходным данным.  

---

## UC-6. Экспорт ролика
**Описание**  
Пользователь экспортирует ролик в MP4 (9:16 для Reels/TikTok).

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Видео готово.

**Триггер**  
Пользователь нажимает «Экспорт».

**Успешный сценарий**
1. Пользователь выбирает формат.  
2. Система запускает рендеринг.  
3. Файл доступен для скачивания/публикации.  


**Негативный сценарий**
- Ошибка рендера.  

**Конечное состояние**  
Файл готов к скачиванию/публикации.  

**Критерии приёмки**  
- Корректный MP4 9:16.  
- Параметры экспорта применяются.  

---

## UC-7. История
**Описание**  
Пользователь просматривает историю созданных роликов.

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Есть задачи.

**Триггер**  
Пользователь открывает «История».

**Успешный сценарий**
1. UI показывает список задач.  
2. Пользователь открывает предпросмотр/скачивает/удаляет.  

**Альтернативный сценарий**
- Массовое удаление.  

**Негативный сценарий**
- Ошибка при удалении/скачивании.  

**Конечное состояние**  
История обновлена.  

**Критерии приёмки**  
- Список задач с фильтрами.  
- Метаданные и действия доступны.  

---

## UC-8. Версионирование роликов
**Описание**  
Система хранит версии ролика (черновики, финальные).

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Есть хотя бы один ролик.

**Триггер**  
Сохранение/корректировка.

**Успешный сценарий**
1. Система сохраняет новую версию.  
2. Пользователь просматривает список версий.  
3. Пользователь восстанавливает/скачивает нужную.  

**Альтернативный сценарий**
- Автосохранение.  

**Негативный сценарий**
- Превышен лимит хранилища.  

**Конечное состояние**  
Выбранная версия активна.  

**Критерии приёмки**  
- Список версий с превью.  
- Возможность отката.  

---

## UC-9. Корректировка ролика
**Описание**  
Пользователь вручную редактирует ролик.

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Видео в предпросмотре.

**Триггер**  
Пользователь нажимает «Редактировать».

**Успешный сценарий**
1. UI открывает редактор.  
2. Пользователь меняет порядок клипов, титры, громкость.  
3. Система сохраняет изменения как новую версию.  

**Альтернативный сценарий**
- Быстрая правка по шаблону.  

**Негативный сценарий**
- Конфликт версий.  

**Конечное состояние**  
Ролик обновлён.  

**Критерии приёмки**  
- Таймлайн-редактор.  
- Сохранение в новую версию.  

---

## UC-10. Уведомления
**Описание**  
Система уведомляет пользователя о статусе задач.

**Акторы**  
- Система  
- Пользователь  

**Начальное состояние**  
Есть активная задача.

**Триггер**  
Изменение статуса.

**Успешный сценарий**
1. Система отправляет уведомление (in-app/email/push).  
2. Пользователь кликает → открывается предпросмотр/история.  

**Альтернативный сценарий**
- Настройки уровня уведомлений.  

**Негативный сценарий**
- Ошибка при доставке email.  

**Конечное состояние**  
Пользователь уведомлён.  

**Критерии приёмки**  
- Разные каналы уведомлений.  
- Настройки доступны.  

---

## UC-11. Музыка
**Описание**  
Пользователь выбирает музыку для ролика.

**Акторы**  
- Пользователь  
- Система  

**Начальное состояние**  
Ролик на этапе редактирования.

**Триггер**  
Пользователь нажимает «Выбрать музыку».

**Успешный сценарий**
1. UI показывает список треков.  
2. Пользователь прослушивает.  
3. Ставит галочку для выбора.  
4. (Опционально) Загружает свою музыку.  

**Альтернативный сценарий**
- Автоподбор по эмоции.  

**Негативный сценарий**
- Ошибка загрузки файла.  
- Лицензионные ограничения.  

**Конечное состояние**  
Трек выбран.  

**Критерии приёмки**  
- Прослушивание доступно.  
- Галочка выбора трека.  
- Загрузка своей музыки.  

---


---

# Alternative Flows

## Alternative A: Неправильная/недоступная ссылка или недостаток прав
**Когда:** На этапе 4: система обнаруживает некорректную ссылку или отсутствие прав доступа.
**Шаги:**
- Система отображает сообщение об ошибке и инструкции (например: «Неверная ссылка» или «Дайте боту доступ/сделайте канал публичным»).
- Пользователь исправляет ссылку или предоставляет доступ.
- Возврат к шагу 4.
**User Value:** быстрый результат при отсутствии медиа; снижает время обработки и потребление ресурсов.


## Alternative B: Пользователь отменил процесс на середине

**Когда:** пользователь передумал и хочет остановить генерацию.
**Шаги:**
- На шаге 5–6 пользователь нажимает кнопку «Отмена».
- Бэкенд останавливает pipeline, очищает временные файлы.
- UI предлагает сохранить черновик (например, собранный список медиа/событий).
**User Value:** пользователь сохраняет контроль, не тратит ресурсы и время на ненужный результат.

---

# Error Handling

## Error 1: Технический сбой
**Проявление:** невозможно получить сообщения или анализ останавливается с ошибкой.
**Как обрабатывать:**
- Повтор до N попыток.
- Фоллбек: частичная обработка доступных данных и информирование пользователя о полной/частичной генерации.
- Логи + алерты ошибки.
**UX:** показать пользователю понятное сообщение: "Мы столкнулись с технической ошибкой при подключении к Telegram/AI"


## Error 2: Некорректный ввод / недостаточные права
**Проявление:** авторизация не пройдена или нет доступа к каналу.
**Как обрабатывать:**
- Валидировать токен при получении и отображать точную причину (настройки приватности, требуется роль администратора).
**UX:** уведомление: "Недостаточно прав для чтения сообщений. Проверьте настройки и повторите авторизацию."
**User Value:** снижает фрикции при подключении, экономит время на поддержку.

## Error 3: Ошибка рендеринга видео
**Проявление:** финальный экспорт обрывается из-за нехватки ресурсов на сервере.
**Как обрабатывать:**
- Автоматическая повторная сборка в фоновом режиме.
- Логирование и отправка ошибки в мониторинг.
**UX:** уведомление: "При рендеринге возникла ошибка"
**User Value:** Пользовател узнает об ошибке




